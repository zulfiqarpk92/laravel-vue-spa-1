"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[395,968],{3668:(t,e,n)=>{n.d(e,{Z:()=>o});const r={props:["label","value","errorMessage"],data:function(){return{popupModal:!1,currentValue:this.value}},watch:{value:function(t,e){t!==e&&(this.currentValue=t)}},methods:{handleInput:function(){this.$emit("input",this.currentValue),this.popupModal=!1}}};const o=(0,n(1900).Z)(r,(function(){var t=this,e=t._self._c;return e("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:t._u([{key:"activator",fn:function(n){var r=n.on,o=n.attrs;return[e("v-text-field",t._g(t._b({attrs:{"error-messages":t.errorMessage,label:t.label,"prepend-icon":"mdi-calendar",readonly:""},model:{value:t.currentValue,callback:function(e){t.currentValue=e},expression:"currentValue"}},"v-text-field",o,!1),r))]}}]),model:{value:t.popupModal,callback:function(e){t.popupModal=e},expression:"popupModal"}},[t._v(" "),e("v-date-picker",{attrs:{scrollable:""},on:{input:t.handleInput},model:{value:t.currentValue,callback:function(e){t.currentValue=e},expression:"currentValue"}})],1)}),[],!1,null,null,null).exports},8968:(t,e,n)=>{n.r(e),n.d(e,{default:()=>o});const r={data:function(){return{loading:!1,invoiceItems:[],searchLoading:!1,searchItems:[],searchText:null,searchItem:null,searchDebounce:null}},watch:{searchText:function(t){var e=this;t&&(clearTimeout(this.searchDebounce),this.searchDebounce=setTimeout((function(){t&&t!==e.searchItem&&e.querySelections(t)}),350))}},methods:{querySelections:function(t){var e=this;this.searchLoading=!0,this.$http.get("/api/items/search?q="+t).then((function(t){var n=t.data;e.searchItems=n,e.searchLoading=!1}))},selectItem:function(t){this.$emit("selected",t),this.searchItem=null,this.searchText=null,this.searchItems=[]}}};const o=(0,n(1900).Z)(r,(function(){var t=this,e=t._self._c;return e("v-autocomplete",{attrs:{loading:t.searchLoading,items:t.searchItems,"search-input":t.searchText,"item-text":"item_name","item-value":"id",flat:"","hide-no-data":"","hide-details":"",clearable:"",label:"Search Item"},on:{"update:searchInput":function(e){t.searchText=e},"update:search-input":function(e){t.searchText=e}},scopedSlots:t._u([{key:"item",fn:function(n){return[e("v-list-item-content",{on:{click:function(e){return t.selectItem(n.item)}}},[e("v-list-item-title",{domProps:{innerHTML:t._s(n.item.item_name)}}),t._v(" "),e("v-list-item-subtitle",{domProps:{innerHTML:t._s(n.item.category)}})],1)]}}]),model:{value:t.searchItem,callback:function(e){t.searchItem=e},expression:"searchItem"}})}),[],!1,null,null,null).exports},395:(t,e,n)=>{n.r(e),n.d(e,{default:()=>l});var r=n(5714),o=n(8968);function a(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){l=!0,a=t},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const s={components:{DatePicker:n(3668).Z,ItemLookup:o.default},middleware:"auth",data:function(){return{loading:!1,form:new r.ZP({comment:"",invoiceItems:[]})}},methods:{onSaleDateChange:function(t){this.form.sale_time=t},selectCustomer:function(t){var e=t.id;this.form.customer_id=e||0},addItem:function(t){var e,n,r,o=!1,i=a(this.form.invoiceItems);try{for(i.s();!(e=i.n()).done;){var s=e.value;s.item_id===t.id&&(s.quantity+=1,o=!0)}}catch(t){i.e(t)}finally{i.f()}o||(console.log(t),this.form.invoiceItems.push({item_id:t.id,name:t.item_name,cost_price:parseFloat(null!==(n=t.cost_price)&&void 0!==n?n:0),sale_price:parseFloat(null!==(r=t.sale_price)&&void 0!==r?r:0),quantity:1,total:0}))},removeItem:function(t){this.form.invoiceItems=this.form.invoiceItems.filter((function(e){return e.id!==t}))},submitForm:function(){var t=this;this.form.post("/api/sales").then((function(e){t.$router.push({name:"sales"})})).catch((function(t){console.log(t)}))}}};const l=(0,n(1900).Z)(s,(function(){var t=this,e=t._self._c;return e("div",[e("v-card",{attrs:{rounded:"lg"}},[e("v-app-bar",{attrs:{dense:"",flat:""}},[e("v-btn",{staticClass:"mr-4",attrs:{text:"",to:"/sales?list"}},[e("v-icon",[t._v("\n          mdi-arrow-left\n        ")])],1),t._v(" "),e("v-toolbar-title",[t._v(t._s("New Bill"))])],1),t._v(" "),t.loading?t._e():e("v-form",[e("v-container",[e("form-alert",{attrs:{form:t.form}}),t._v(" "),e("v-row",[e("v-col",{attrs:{cols:"12",md:"6"}},[e("user-lookup",{on:{selected:t.selectCustomer}})],1),t._v(" "),e("v-col",{attrs:{cols:"12",md:"6"}},[e("date-picker",{attrs:{"error-message":t.form.errors.get("sale_time")},model:{value:t.form.sale_time,callback:function(e){t.$set(t.form,"sale_time",e)},expression:"form.sale_time"}})],1)],1),t._v(" "),e("v-row",[e("v-col",{attrs:{cols:"12",md:"12"}},[e("item-lookup",{on:{selected:t.addItem}})],1)],1),t._v(" "),e("v-row",[e("v-col",{attrs:{cols:"12",md:"12"}},[e("v-simple-table",{attrs:{dense:""},scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticStyle:{width:"100px"}}),t._v(" "),e("th",{staticStyle:{width:"100px"}},[t._v("\n                      Item #\n                    ")]),t._v(" "),e("th",[t._v("Name")]),t._v(" "),e("th",{staticStyle:{width:"100px"}},[t._v("\n                      Price\n                    ")]),t._v(" "),e("th",{staticStyle:{width:"100px"}},[t._v("\n                      Qty\n                    ")]),t._v(" "),e("th",{staticStyle:{width:"100px"}},[t._v("\n                      Total\n                    ")])])]),t._v(" "),e("tbody",t._l(t.form.invoiceItems,(function(n){return e("tr",{key:n.id},[e("td",[e("v-btn",{staticClass:"ma-2",attrs:{text:"",icon:"",color:"red"},on:{click:function(e){return t.removeItem(n.item_id)}}},[e("v-icon",[t._v("\n                          mdi-delete\n                        ")])],1)],1),t._v(" "),e("td",[t._v(t._s(n.item_id))]),t._v(" "),e("td",[e("v-text-field",{model:{value:n.name,callback:function(e){t.$set(n,"name",e)},expression:"item.name"}})],1),t._v(" "),e("td",[e("v-text-field",{model:{value:n.sale_price,callback:function(e){t.$set(n,"sale_price",e)},expression:"item.sale_price"}})],1),t._v(" "),e("td",[e("v-text-field",{attrs:{type:"number"},model:{value:n.quantity,callback:function(e){t.$set(n,"quantity",e)},expression:"item.quantity"}})],1),t._v(" "),e("td",[t._v(t._s(parseFloat(n.sale_price*n.quantity)))])])})),0),t._v(" "),e("tfoot",[e("tr",[e("th"),t._v(" "),e("th"),t._v(" "),e("th"),t._v(" "),e("th"),t._v(" "),e("th",[t._v(t._s(t.form.invoiceItems.reduce((function(t,e){return t+parseFloat(e.quantity)}),0)))]),t._v(" "),e("th",[t._v(t._s(t.form.invoiceItems.reduce((function(t,e){return t+parseFloat(e.sale_price*e.quantity)}),0)))])])])]},proxy:!0}],null,!1,3587084103)}),t._v(" "),e("span",{staticClass:"error--text"},[t._v(t._s(t.form.errors.get("invoiceItems")))])],1)],1),t._v(" "),e("v-row",[e("v-col")],1),t._v(" "),e("v-row",[e("v-col",{attrs:{cols:"12",md:"12"}},[e("v-textarea",{attrs:{label:"Comments",rows:"2"},model:{value:t.form.comment,callback:function(e){t.$set(t.form,"comment",e)},expression:"form.comment"}})],1)],1),t._v(" "),e("v-row",[e("v-col",[e("v-btn",{staticClass:"mr-4",attrs:{color:"success",loading:t.form.busy,disabled:t.form.busy},on:{click:t.submitForm}},[t._v("\n              Submit\n            ")]),t._v(" "),e("v-btn",{attrs:{color:"error",to:"/sales"}},[t._v("\n              Cancel\n            ")])],1)],1)],1)],1)],1)],1)}),[],!1,null,null,null).exports}}]);